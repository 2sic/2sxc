/*! tosic.eav 2015-09-20 08:41 */

!function(){"use strict";var a=angular.module("eavEditEntity",["formly","eavFieldTemplates","eavNgSvcs","EavServices","eavEditTemplates"]);a.directive("eavEditEntity",function(){return{templateUrl:"edit-entity.html",restrict:"E",scope:{contentTypeName:"@contentTypeName",entityId:"@entityId",registerEditControl:"=registerEditControl"},controller:"EditEntityCtrl",controllerAs:"vm"}}),a.controller("EditEntityCtrl",["$http","$scope","formlyConfig","contentTypeFieldSvc","entitiesSvc",function(a,b,c,d,e){var f=this;f.editInDefaultLanguageFirst=function(){return!1},f.save=function(){alert("Saving not implemented yet!")},f.control={isValid:function(){return f.form.$valid},save:f.save},b.registerEditControl&&b.registerEditControl(f.control),f.model=null,f.entity=null,f.formFields=null;var g=function(){d(1,{StaticName:f.entity.Type.Name}).getFields().then(function(a){f.debug=a,angular.forEach(a.data,function(a,b){void 0===a.Metadata.All&&(a.Metadata.All={}),f.formFields.push({key:a.StaticName,type:h(a),templateOptions:{required:!!a.Metadata.All.Required,label:void 0===a.Metadata.All.Name?a.StaticName:a.Metadata.All.Name,description:a.Metadata.All.Notes,settings:a.Metadata},hide:a.Metadata.All.VisibleInEditUI?!a.Metadata.All.VisibleInEditUI:!1,expressionProperties:{"templateOptions.disabled":"options.templateOptions.disabled"}})})})};b.entityId?e.getMultiLanguage(1,b.contentTypeName,b.entityId).then(function(a){f.entity=a.data,g()}):(f.entity=e.newEntity(b.contentTypeName),g());var h=function(a){var b=a,d=b.Type.toLowerCase(),e=void 0!==b.Metadata.String?b.Metadata.String.InputType:null;return e=e?e.toLowerCase():null,"string"===d&&void 0!==b.Metadata.String&&b.Metadata.String.RowCount>1&&(e="textarea"),e&&c.getType(d+"-"+e)||(e="default"),d+"-"+e}}])}(),function(){"use strict";var a=angular.module("eavFieldTemplates",["formly","formlyBootstrap","ui.bootstrap","eavLocalization"],["formlyConfigProvider",function(a){a.setType({name:"string-default",template:'<input class="form-control" ng-model="value.Value">',wrapper:["bootstrapLabel","bootstrapHasError","eavLocalization"]}),a.setType({name:"string-dropdown",template:'<select class="form-control" ng-model="value.Value"></select>',wrapper:["bootstrapLabel","bootstrapHasError","eavLocalization"],defaultOptions:function(a){function b(a,b,c){return Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}if(!a.templateOptions.options&&a.templateOptions.settings.String.DropdownValues){var c=a.templateOptions.settings.String.DropdownValues;c=c.replace("\r","").split("\n"),c=c.map(function(a,b){var c=a.split(":");return{name:c[0],value:c[1]?c[1]:c[0]}}),a.templateOptions.options=c}var d=a.templateOptions.ngOptions||"option[to.valueProp || 'value'] as option[to.labelProp || 'name'] group by option[to.groupProp || 'group'] for option in to.options";return{ngModelAttrs:b({},d,{value:"ng-options"})}}}),a.setType({name:"string-textarea",template:'<textarea class="form-control" ng-model="value.Value"></textarea>',wrapper:["bootstrapLabel","bootstrapHasError","eavLocalization"],defaultOptions:{ngModelAttrs:{"{{to.settings.String.RowCount}}":{value:"rows"},cols:{attribute:"cols"}}}}),a.setType({name:"number-default",template:'<input type="number" class="form-control" ng-model="value.Value">{{vm.isGoogleMap}}',wrapper:["bootstrapLabel","bootstrapHasError","eavLocalization"],defaultOptions:{ngModelAttrs:{"{{to.settings.Number.Min}}":{value:"min"},"{{to.settings.Number.Max}}":{value:"max"},'{{to.settings.Number.Decimals ? "^[0-9]+(.[0-9]{1," + to.settings.Number.Decimals + "})?$" : null}}':{value:"pattern"}}},controller:"FieldTemplate-NumberCtrl as vm"}),a.setType({name:"boolean-default",template:'<div class="checkbox">\n	<label>\n		<input type="checkbox"\n           class="formly-field-checkbox"\n		       ng-model="value.Value">\n		{{to.label}}\n		{{to.required ? \'*\' : \'\'}}\n	</label>\n</div>\n',wrapper:["bootstrapLabel","bootstrapHasError","eavLocalization"]}),a.setType({name:"datetime-default",wrapper:["bootstrapLabel","bootstrapHasError","eavLocalization"],template:'<div><div class="input-group"><div class="input-group-addon" style="cursor:pointer;" ng-click="to.isOpen = true;"><i class="glyphicon glyphicon-calendar"></i></div><input class="form-control" ng-model="value.Value" is-open="to.isOpen" datepicker-options="to.datepickerOptions" datepicker-popup /></div><timepicker ng-show="to.settings.DateTime.UseTimePicker" ng-model="value.Value" show-meridian="ismeridian"></timepicker></div>',defaultOptions:{templateOptions:{datepickerOptions:{},datepickerPopup:"dd.MM.yyyy"}}})}]);a.controller("FieldTemplate-NumberCtrl",function(){var a=this;a.isGoogleMap="test"})}(),angular.module("eavEditTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("edit-entity.html",'<div ng-show=vm.editInDefaultLanguageFirst()>Please edit this in the default language first.</div><div ng-show=!vm.editInDefaultLanguageFirst()><formly-form ng-submit=vm.onSubmit() form=vm.form model=vm.entity.Attributes fields=vm.formFields></formly-form><a ng-click="vm.showDebug = !vm.showDebug;">Debug</a><div ng-if=vm.showDebug><h3>Debug</h3><pre>{{vm.entity | json}}</pre><pre>{{vm.debug | json}}</pre><pre>{{vm.formFields | json}}</pre></div></div>'),a.put("fields/templates/entity-default.html",'<div class=eav-entityselect><div ui-tree=options data-empty-place-holder-enabled=false><ol ui-tree-nodes ng-model=model[options.key]><li ng-repeat="item in model[options.key]" ui-tree-node class=eav-entityselect-item><div ui-tree-handle><span title="{{getEntityText(item) + \' (\' + item + \')\'}}">{{getEntityText(item)}}</span> <a data-nodrag title="Remove this item" ng-click=remove(this) class=eav-entityselect-item-remove>[remove]</a></div></li></ol></div><select class="eav-entityselect-selector form-control" ng-model=selectedEntity ng-change=addEntity() ng-show="to.settings.Entity.AllowMultiValue || model[options.key].length < 1"><option value="">-- choose --</option><option value=new ng-if=createEntityAllowed()>-- new --</option><option ng-repeat="item in availableEntities" ng-disabled="model[options.key].indexOf(item.Value) != -1" value={{item.Value}}>{{item.Text}}</option></select></div>'),a.put("localization/formly-localization-wrapper.html","<eav-localization-scope-control></eav-localization-scope-control><div ng-if=value><eav-localization-menu field-model=model[options.key] options=options></eav-localization-menu><formly-transclude></formly-transclude></div><p class=bg-info style=padding:12px ng-if=!value>Please create the value for <i>'{{to.label}}'</i> in the default language before translating it.</p>"),a.put("localization/language-switcher.html",'<ul class="nav nav-pills" style=margin-left:0><li ng-repeat="l in languages.languages" ng-class="{ active: languages.currentLanguage == l.key }"><a ng-click="languages.currentLanguage = l.key;" href=javascript:void(0);>{{l.name}}</a></li></ul>'),a.put("localization/localization-menu.html",'<div dropdown is-open=status.isopen class=eav-localization><a class=eav-localization-lock ng-if=vm.isDefaultLanguage() ng-class="{ \'eav-localization-lock-open\': !options.templateOptions.disabled }" dropdown-toggle href=javascript:void(0)><i class="glyphicon glyphicon-globe"></i></a><ul class="dropdown-menu multi-level pull-right eav-localization-dropdown" role=menu aria-labelledby=single-button><li role=menuitem><a ng-click=vm.actions.translate()>Translate</a></li><li role=menuitem><a href=#>Another action</a></li><li role=menuitem class=dropdown-submenu><a href=#>Something else here</a><ul class=dropdown-menu><li role=menuitem><a href=#>Action</a></li><li role=menuitem><a href=#>Another action</a></li></ul></li><li class=divider></li><li role=menuitem><a href=#>Separated link</a></li></ul></div>'),a.put("wrappers/edit-entity-wrapper.html",'<div class=modal-header><h3 class=modal-title>Edit entity</h3></div><div class=modal-body><div xng-controller="EditEntityWrapperCtrl as vm"><eav-language-switcher></eav-language-switcher><eav-edit-entity content-type-name={{vm.contentTypeName}} entity-id={{vm.entityId}} register-edit-control=vm.registerEditControl></eav-edit-entity><button ng-disabled=!vm.isValid() ng-click=vm.save() class="btn btn-primary submit-button">Save</button></div></div>')}]),function(){"use strict";var a=angular.module("eavLocalization",["formly","EavConfiguration"],["formlyConfigProvider",function(a){a.setWrapper([{name:"eavLocalization",templateUrl:"localization/formly-localization-wrapper.html"}])}]);a.directive("eavLanguageSwitcher",function(){return{restrict:"E",templateUrl:"localization/language-switcher.html",controller:["$scope","languages",function(a,b){a.languages=b}]}}),a.directive("eavLocalizationScopeControl",function(){return{restrict:"E",transclude:!0,template:"",link:function(a,b,c){},controller:["$scope","$filter","eavDefaultValueService","languages",function(a,b,c,d){var e=a,f=d,g=function(){e.model[e.options.key]||(e.model[e.options.key]={Values:[]});var a=e.model[e.options.key];if(f.currentLanguage==f.defaultLanguage&&0===a.Values.length){var d=c(e.options);a.Values.push({Value:d,Dimensions:{}}),a.Values[0].Dimensions[f.currentLanguage]=!0}var g;if(g=b("filter")(a.Values,function(a,b){return void 0!==a.Dimensions[f.currentLanguage]})[0],void 0===g&&(g=b("filter")(a.Values,function(a,b){return void 0!==a.Dimensions[f.defaultLanguage]})[0]),void 0===g){if(a.Values.length>1)throw"Default language value not found, but found multiple values - can't handle editing";g=a.Values[0]}a._currentValue=g,e.value=a._currentValue;var h=f.currentLanguage==f.defaultLanguage||e.value&&e.value.Dimensions[f.currentLanguage];e.to.disabled=!h};g(),e.langConf=f,e.$watch("langConf.currentLanguage",function(a,b){void 0!==b&&a!=b&&(g(),console.log("switched language from "+b+" to "+a))}),e.$watch("model[options.key].Values",function(a,b){g()},!0),e.model[e.options.key]._initCurrentValue=g}]}}),a.directive("eavLocalizationMenu",function(){return{restrict:"E",scope:{fieldModel:"=fieldModel",options:"=options"},templateUrl:"localization/localization-menu.html",link:function(a,b,c){},controllerAs:"vm",controller:["$scope","languages",function(a,b){var c=this;c.fieldModel=a.fieldModel,c.isDefaultLanguage=function(){return b.currentLanguage!=b.defaultLanguage},c.actions={translate:function(){var a={Value:"New translated value!",Dimensions:{}};a.Dimensions[b.currentLanguage]=!0,c.fieldModel.Values.push(a)}}}]}})}(),function(){"use strict";angular.module("eavEditEntity").service("eavDefaultValueService",function(){return function(a){var b=a,c=b.templateOptions.settings.DefaultValue;switch(b.type.split("-")[0]){case"boolean":return void 0!==c?"true"==c.toLowerCase():!1;case"datetime":return void 0!==c?new Date(c):null;case"entity":return[];case"number":return null;default:return c?c:""}}})}(),function(){"use strict";var a=angular.module("eavEditEntity");a.controller("EditEntityWrapperCtrl",["$http","$scope","contentTypeName","entityId",function(a,b,c,d){var e=this;e.contentTypeName=c,e.entityId=d,e.registeredControls=[],e.registerEditControl=function(a){e.registeredControls.push(a)},e.isValid=function(){var a=!0;return angular.forEach(e.registeredControls,function(b,c){b.isValid()||(a=!1)}),a},e.save=function(){var a=[];angular.forEach(e.registeredControls,function(b,c){a.push(b.save())}),$q.all(a).then(function(){alert("All save promises resolved!")})}}])}();
//# sourceMappingURL=eav-edit.min.js.map