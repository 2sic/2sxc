"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_visual-query_visual-query_module_ts"],{794:(Qt,Y,c)=>{c.r(Y),c.d(Y,{VisualQueryModule:()=>At});var m=c(6362),_=c(587),P=c(7317),v=c(5758),Q=c(4770),T=c(5590),G=c(4683),H=c(1434),A=c(6623),j=c(2528),M=c(2379),B=c(7066),V=c(1667),w=c(5368),ie=c(3135),y=c(635),Z=c(4536),h=c(941),e=c(3184),oe=c(8784),ae=c(2425);let q=(()=>{class i{constructor(t,n,o){this.http=t,this.context=n,this.dnnContext=o}fetchPipeline(t,n){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.TB),{params:{appId:this.context.appId.toString(),id:t.toString()}}).pipe((0,y.U)(o=>(o.DataSources.length||this.buildDefaultModel(o,n),this.fixPipelineDataSources(o.DataSources),o)))}buildDefaultModel(t,n){const o=h.Z.pipelineDesigner.defaultPipeline.dataSources;for(const s of o){const r=n.find(u=>u.PartAssemblyAndType===s.PartAssemblyAndType);t.DataSources.push({Description:"",EntityGuid:s.EntityGuid,EntityId:void 0,Name:r.Name,PartAssemblyAndType:s.PartAssemblyAndType,VisualDesignerData:s.VisualDesignerData})}t.Pipeline.StreamWiring=h.Z.pipelineDesigner.defaultPipeline.streamWiring}fixPipelineDataSources(t){var n;if(!t.some(s=>s.EntityGuid===h.Z.pipelineDesigner.outDataSource.EntityGuid)){const s=h.Z.pipelineDesigner.outDataSource;t.push({Description:s.Description,EntityGuid:s.EntityGuid,EntityId:void 0,Name:s.Name,PartAssemblyAndType:s.PartAssemblyAndType,VisualDesignerData:s.VisualDesignerData})}for(const s of t)null!==(n=s.VisualDesignerData)&&void 0!==n||(s.VisualDesignerData={Top:50,Left:50})}fetchDataSources(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.bf)).pipe((0,y.U)(t=>{const n=h.Z.pipelineDesigner.outDataSource;return t.push({ContentType:void 0,Difficulty:h.Z.pipelineDesigner.dataSourceDifficulties.default,DynamicIn:!0,DynamicOut:!1,EnableConfig:void 0,HelpLink:void 0,Icon:void 0,In:n.In,Name:n.Name,Out:void 0,PartAssemblyAndType:n.PartAssemblyAndType,PrimaryType:n.PrimaryType,TypeNameForUi:void 0,UiHint:void 0}),t}))}typeNameFilter(t,n){const o=t.split(", ");switch(n){case"classFullName":return o[0];case"className":const r=o[0].split(".");return r[r.length-1];default:return t}}savePipeline(t){const n=t.Pipeline,o=t.DataSources;return this.http.post(this.dnnContext.$2sxc.http.apiUrl(Z.nt),{pipeline:n,dataSources:o},{params:{appId:this.context.appId.toString(),Id:n.EntityId.toString()}}).pipe((0,y.U)(s=>(this.fixPipelineDataSources(s.DataSources),s)))}runPipeline(t,n){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.cv),{params:{appId:this.context.appId.toString(),id:t.toString(),top:n.toString()}})}debugStream(t,n,o,s){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.Az),{params:{appId:this.context.appId.toString(),id:t.toString(),from:n,out:o,top:s.toString()}})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(oe.eN),e.LFG(w._),e.LFG(ae._y))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var b=c(2977),W=c(2211),se=c(2649),I=c(6317),J=c(7714),z=c(8977),F=c(6562),O=c(2423),re=c(4251),S=c(2215),le=c(253),ce=c(3280),k=c(116),X=c(4874),ue=c(679),L=c(2225),E=c(6190);function pe(i,a){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.AsE(' for Stream: "',t.debugStream.name,'" on Source: "',t.debugStream.sourceName,'" ')}}function de(i,a){1&i&&(e.TgZ(0,"div",12)(1,"span"),e._uU(2,"Results"),e.qZA()())}function me(i,a){1&i&&(e.ynx(0),e._uU(1,"Showing All results"),e.BQk())}function ge(i,a){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.hij("Showing top ",t.top," results")}}function fe(i,a){1&i&&(e.ynx(0),e._uU(1,"All"),e.BQk())}function he(i,a){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t)}}function _e(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw().show(s)}),e._uU(1," Show "),e.YNc(2,fe,2,0,"ng-container",2),e.YNc(3,he,2,1,"ng-container",2),e.qZA()}if(2&i){const t=a.$implicit;e.xp6(2),e.Q6J("ngIf",0===t),e.xp6(1),e.Q6J("ngIf",0!==t)}}function ve(i,a){1&i&&(e.TgZ(0,"div",15)(1,"span"),e._uU(2,"Parameters"),e.qZA()())}function ye(i,a){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.xp6(1),e.Oqu(t)}}function xe(i,a){if(1&i&&(e.TgZ(0,"mat-tab"),e.YNc(1,ve,3,0,"div",14),e._UZ(2,"br"),e.TgZ(3,"ul",7),e.YNc(4,ye,2,1,"li",10),e.qZA()()),2&i){const t=e.oxw();e.xp6(4),e.Q6J("ngForOf",t.parameters)}}function be(i,a){1&i&&(e.TgZ(0,"div",16)(1,"span"),e._uU(2,"Sources"),e.qZA()())}function Se(i,a){if(1&i&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(null==t.value.Definition?null:t.value.Definition.Name)}}function Ce(i,a){if(1&i&&(e.TgZ(0,"li")(1,"b"),e._uU(2),e.qZA(),e._uU(3,"="),e.TgZ(4,"em"),e._uU(5),e.qZA()()),2&i){const t=a.$implicit;e.xp6(2),e.Oqu(t.key),e.xp6(3),e.Oqu(t.value)}}function Te(i,a){if(1&i&&(e.TgZ(0,"tr")(1,"td"),e.YNc(2,Se,2,1,"div",2),e.TgZ(3,"pre"),e._uU(4),e.qZA()(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td")(8,"ol"),e.YNc(9,Ce,6,2,"li",10),e.ALo(10,"keyvalue"),e.qZA()(),e.TgZ(11,"td"),e._uU(12),e.qZA()()),2&i){const t=a.$implicit;e.xp6(2),e.Q6J("ngIf",null==t.value.Definition?null:t.value.Definition.Name),e.xp6(2),e.Oqu(t.value.Guid),e.xp6(2),e.Oqu(t.value.Type),e.xp6(3),e.Q6J("ngForOf",e.lcZ(10,5,t.value.Configuration)),e.xp6(3),e.Oqu(t.value.Error)}}function De(i,a){1&i&&(e.TgZ(0,"div",17)(1,"span"),e._uU(2,"Streams"),e.qZA()())}function Ze(i,a){if(1&i&&(e.TgZ(0,"tr")(1,"td")(2,"pre"),e._uU(3),e.qZA()(),e.TgZ(4,"td")(5,"pre"),e._uU(6),e.qZA()(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA()()),2&i){const t=a.$implicit;e.xp6(3),e.Oqu(t.Source+":"+t.SourceOut),e.xp6(3),e.Oqu(t.Target+":"+t.TargetIn),e.xp6(2),e.Oqu(t.Count),e.xp6(2),e.Oqu(t.Error)}}let Ee=(()=>{class i{constructor(t,n,o){this.dialogData=t,this.dialogRef=n,this.visualQueryService=o}ngOnInit(){var t,n,o,s;const r=this.visualQueryService.pipelineModel$.value.Pipeline,l=(null!==(n=null===(t=r.Params)||void 0===t?void 0:t.split("\n"))&&void 0!==n?n:[]).filter(p=>!!p),u=(null!==(s=null===(o=r.TestParameters)||void 0===o?void 0:o.split("\n"))&&void 0!==s?s:[]).filter(p=>!!p);this.parameters=[].concat(l,u),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams}closeDialog(){this.dialogRef.close()}show(t){t!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,t):this.visualQueryService.runPipeline(t),this.closeDialog())}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(v.WI),e.Y36(v.so),e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-query-result"]],decls:50,vars:14,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[4,"ngIf"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"dialog-description"],["dynamicHeight","","color","accent"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"description"],["mat-button","",3,"click",4,"ngFor","ngForOf"],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],[4,"ngFor","ngForOf"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div"),e._uU(3," Query Results "),e.YNc(4,pe,2,2,"ng-container",2),e.qZA(),e.TgZ(5,"button",3),e.NdJ("click",function(){return n.closeDialog()}),e.TgZ(6,"mat-icon"),e._uU(7,"close"),e.qZA()()()(),e.TgZ(8,"p",4),e._uU(9),e.qZA(),e.TgZ(10,"mat-tab-group",5)(11,"mat-tab"),e.YNc(12,de,3,0,"div",6),e.TgZ(13,"p",7),e.YNc(14,me,2,0,"ng-container",2),e.YNc(15,ge,2,1,"ng-container",2),e.YNc(16,_e,4,2,"button",8),e.qZA(),e.TgZ(17,"pre"),e._uU(18),e.ALo(19,"json"),e.qZA()(),e.YNc(20,xe,5,1,"mat-tab",2),e.TgZ(21,"mat-tab"),e.YNc(22,be,3,0,"div",9),e._UZ(23,"br"),e.TgZ(24,"table",7)(25,"tr")(26,"th"),e._uU(27,"Name and Guid"),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Type"),e.qZA(),e.TgZ(30,"th"),e._uU(31,"Configuration"),e.qZA(),e.TgZ(32,"th"),e._uU(33,"Error"),e.qZA()(),e.YNc(34,Te,13,7,"tr",10),e.ALo(35,"keyvalue"),e.qZA()(),e.TgZ(36,"mat-tab"),e.YNc(37,De,3,0,"div",11),e._UZ(38,"br"),e.TgZ(39,"table",7)(40,"tr")(41,"th"),e._uU(42,"Source"),e.qZA(),e.TgZ(43,"th"),e._uU(44,"Target"),e.qZA(),e.TgZ(45,"th"),e._uU(46,"Items"),e.qZA(),e.TgZ(47,"th"),e._uU(48,"Error"),e.qZA()(),e.YNc(49,Ze,11,4,"tr",10),e.qZA()()()),2&t&&(e.xp6(4),e.Q6J("ngIf",n.debugStream),e.xp6(5),e.AsE(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",n.timeUsed,"ms (",n.ticksUsed," ticks)\n"),e.xp6(5),e.Q6J("ngIf",0===n.top),e.xp6(1),e.Q6J("ngIf",0!==n.top),e.xp6(1),e.Q6J("ngForOf",n.optionsForTop),e.xp6(2),e.Oqu(e.lcZ(19,10,n.result)),e.xp6(2),e.Q6J("ngIf",null==n.parameters?null:n.parameters.length),e.xp6(14),e.Q6J("ngForOf",e.lcZ(35,12,n.sources)),e.xp6(15),e.Q6J("ngForOf",n.streams))},directives:[v.uh,m.O5,P.lW,E.$,T.Hw,M.SP,M.uX,M.uD,m.sg],pipes:[m.Ts,m.Nd],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}"]}),i})(),Pe=(()=>{class i{constructor(t,n){this.dialogData=t,this.dialogRef=n}ngOnInit(){this.errorData=this.dialogData.errorData}closeDialog(){this.dialogRef.close()}openInsights(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api"),"_blank")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(v.WI),e.Y36(v.so))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-stream-error-result"]],decls:17,vars:3,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","tippy","Close dialog",3,"click"],["mat-button","","tippy","Open 2sxc Insights",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div"),e._uU(3,"Stream Error Results"),e.qZA(),e.TgZ(4,"button",2),e.NdJ("click",function(){return n.closeDialog()}),e.TgZ(5,"mat-icon"),e._uU(6,"close"),e.qZA()()()(),e._UZ(7,"br"),e.TgZ(8,"pre"),e._uU(9),e.ALo(10,"json"),e.qZA(),e.TgZ(11,"div")(12,"button",3),e.NdJ("click",function(){return n.openInsights()}),e.TgZ(13,"mat-icon"),e._uU(14,"speed"),e.qZA(),e.TgZ(15,"span"),e._uU(16,"Insights"),e.qZA()()()),2&t&&(e.xp6(9),e.Oqu(e.lcZ(10,1,n.errorData)))},directives:[v.uh,P.lW,E.$,T.Hw],pipes:[m.Ts],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]}),i})();var Ae=c(318);let D=(()=>{class i{constructor(t,n,o,s,r,l,u,p,d,f,x){this.router=t,this.route=n,this.queryDefinitionService=o,this.titleService=s,this.snackBar=r,this.dialog=l,this.viewContainerRef=u,this.zone=p,this.metadataService=d,this.contentTypesService=f,this.changeDetectorRef=x,this.pipelineModel$=new I.X(null),this.dataSources$=new I.X(null),this.putEntityCountOnConnections$=new le.x,this.dataSourceConfigs$=new I.X({}),this.pipelineId=parseInt(this.route.snapshot.paramMap.get("pipelineId"),10),this.refreshPipeline=!1,this.refreshDataSourceConfigs=!1,this.subscription=new J.w0}ngOnDestroy(){this.pipelineModel$.complete(),this.dataSources$.complete(),this.putEntityCountOnConnections$.complete(),this.subscription.unsubscribe()}init(){this.fetchDataSources(()=>this.fetchPipeline(!0,!0,!1)),this.attachKeyboardSave(),this.refreshOnChildClosed()}editPipelineEntity(){this.savePipeline(()=>{const n=(0,L.f)({items:[{EntityId:this.pipelineModel$.value.Pipeline.EntityId}]});this.router.navigate([`edit/${n}`],{relativeTo:this.route}),this.refreshPipeline=!0})}saveAndRun(t,n){t&&n?this.savePipeline(()=>{this.runPipeline()}):t?this.savePipeline():n&&this.runPipeline()}showDataSourceDetails(t){var n;const o=(0,S.Z)(this.pipelineModel$.value),s=null!==(n=O.iX.tryParse(o.Pipeline.VisualDesignerData))&&void 0!==n?n:{};s.ShowDataSourceDetails=t,o.Pipeline.VisualDesignerData=JSON.stringify(s),this.pipelineModel$.next(o)}addDataSource(t){const n=(0,S.Z)(this.pipelineModel$.value);n.DataSources.push({Description:"",EntityGuid:"unsaved"+(n.DataSources.length+1),EntityId:void 0,Name:t.Name,PartAssemblyAndType:t.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}}),this.pipelineModel$.next(n),this.savePipeline()}removeDataSource(t,n,o){const s=(0,S.Z)(this.pipelineModel$.value);s.DataSources=s.DataSources.filter(r=>r.EntityGuid!==t),s.Pipeline.StreamWiring=n,s.Pipeline.StreamsOut=o,this.pipelineModel$.next(s)}renameDataSource(t,n){const o=(0,S.Z)(this.pipelineModel$.value);o.DataSources.find(r=>r.EntityGuid===t).Name=n,this.pipelineModel$.next(o)}changeDataSourceDescription(t,n){const o=(0,S.Z)(this.pipelineModel$.value);o.DataSources.find(r=>r.EntityGuid===t).Description=n,this.pipelineModel$.next(o)}changeConnections(t,n){const o=(0,S.Z)(this.pipelineModel$.value);o.Pipeline.StreamWiring=t,o.Pipeline.StreamsOut=n,this.pipelineModel$.next(o)}changeDataSourcePosition(t,n){const o=(0,S.Z)(this.pipelineModel$.value),s=o.DataSources.find(r=>r.EntityGuid===t);!s||(s.VisualDesignerData=Object.assign(Object.assign({},s.VisualDesignerData),n),this.pipelineModel$.next(o))}calculateDataSourceConfigs(t){const n={};t.forEach(o=>{var s;null!=o.EntityId&&(n[o.EntityId]=[],null===(s=o.Metadata)||void 0===s||s.forEach(r=>{Object.entries(r).forEach(([l,u])=>{var p,d;null==u||""===u||["Created","Guid","Id","Modified","Title","_Type"].includes(l)||(Array.isArray(u)&&null!=(null===(p=u[0])||void 0===p?void 0:p.Title)&&null!=(null===(d=u[0])||void 0===d?void 0:d.Id)&&(u=`${u[0].Title} (${u[0].Id})`),n[o.EntityId].push({name:l,value:u}))})}))}),this.dataSourceConfigs$.next(n)}editDataSource(t){const o=this.dataSources$.value.find(u=>u.PartAssemblyAndType===t.PartAssemblyAndType).ContentType,l=t.EntityGuid;this.metadataService.getMetadata(h.Z.metadata.entity.targetType,h.Z.metadata.entity.keyType,l,o).subscribe(u=>{if(u.Items.length){const d=(0,L.f)({items:[{EntityId:u.Items[0].Id}]});return this.router.navigate([`edit/${d}`],{relativeTo:this.route}),void(this.refreshDataSourceConfigs=!0)}this.contentTypesService.retrieveContentType(o).subscribe({next:p=>{if(null==p)return void this.snackBar.open("DataSource doesn't have any configuration",void 0,{duration:3e3});const f=(0,L.f)({items:[{ContentTypeName:o,For:{Target:h.Z.metadata.entity.target,TargetType:h.Z.metadata.entity.targetType,Guid:l}}]});this.router.navigate([`edit/${f}`],{relativeTo:this.route}),this.refreshDataSourceConfigs=!0},error:p=>{this.snackBar.open("Server reports error - this usually means that this DataSource doesn't have any configuration",void 0,{duration:3e3})}})})}savePipeline(t){this.snackBar.open("Saving..."),this.queryDefinitionService.savePipeline(this.pipelineModel$.value).subscribe({next:n=>{this.snackBar.open("Saved",null,{duration:2e3}),this.pipelineModel$.next(n),null!=t&&t()},error:n=>{this.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})}runPipeline(t=25){this.snackBar.open("Running query..."),this.queryDefinitionService.runPipeline(this.pipelineModel$.value.Pipeline.EntityId,t).subscribe({next:n=>{this.snackBar.open("Query worked",null,{duration:2e3}),this.pipelineResult=n,this.showQueryResult(n,t),console.warn(n),this.pipelineModel$.next((0,S.Z)(this.pipelineModel$.value)),setTimeout(()=>{this.putEntityCountOnConnections$.next(n)})},error:n=>{this.snackBar.open("Query failed",null,{duration:2e3})}})}debugStream(t,n=25){t.Error?this.showStreamErrorResult(t):0!==t.Count&&(this.snackBar.open("Running stream..."),this.queryDefinitionService.debugStream(this.pipelineModel$.value.Pipeline.EntityId,t.Source,t.SourceOut,n).subscribe({next:s=>{this.snackBar.open("Stream worked",null,{duration:2e3});const r=this.pipelineModel$.value.DataSources.find(u=>u.EntityGuid===t.Source);this.showQueryResult(s,n,{name:t.SourceOut,source:t.Source,sourceName:r.Name,original:t}),console.warn(s)},error:s=>{this.snackBar.open("Stream failed",null,{duration:2e3})}}))}fetchPipeline(t,n,o){o&&this.snackBar.open("Reloading query, please wait..."),this.queryDefinitionService.fetchPipeline(this.pipelineId,this.dataSources$.value).subscribe(s=>{o&&this.snackBar.open("Query reloaded",null,{duration:2e3}),this.titleService.setTitle(`${s.Pipeline.Name} - Visual Query`),t&&this.pipelineModel$.next(s),n&&this.calculateDataSourceConfigs(s.DataSources)})}showQueryResult(t,n,o){this.dialog.open(Ee,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{result:t,debugStream:o,top:n},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}showStreamErrorResult(t){this.dialog.open(Pe,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{errorData:t.ErrorData},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}fetchDataSources(t){this.queryDefinitionService.fetchDataSources().subscribe(n=>{this.dataSources$.next(n),t()})}attachKeyboardSave(){this.zone.runOutsideAngular(()=>{this.subscription.add((0,ce.R)(window,"keydown").pipe((0,k.h)(()=>!this.route.snapshot.firstChild),(0,k.h)(t=>(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&83===t.keyCode)).subscribe(t=>{t.preventDefault(),this.zone.run(()=>{this.savePipeline()})}))})}refreshOnChildClosed(){this.subscription.add(this.router.events.pipe((0,k.h)(t=>t instanceof b.m2),(0,X.O)(!!this.route.snapshot.firstChild),(0,y.U)(()=>!!this.route.snapshot.firstChild),(0,ue.G)(),(0,k.h)(([t,n])=>t&&!n)).subscribe(()=>{(this.refreshPipeline||this.refreshDataSourceConfigs)&&this.fetchPipeline(this.refreshPipeline,this.refreshDataSourceConfigs,this.refreshPipeline),this.refreshPipeline=!1,this.refreshDataSourceConfigs=!1}))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(b.F0),e.LFG(b.gz),e.LFG(q),e.LFG(Ae.Dx),e.LFG(j.ux),e.LFG(v.uw),e.LFG(e.s_b),e.LFG(e.R0b),e.LFG(V.D),e.LFG(B.s),e.LFG(e.sBO))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();const R={Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};function Ie(i,a){const t={};for(const n of i){let o;const s=a.find(r=>r.PartAssemblyAndType===n.PartAssemblyAndType);s&&(o=Object.assign({},s.PrimaryType?R[s.PrimaryType]:R.Unknown),null!=s.Icon&&(o.Icon=s.Icon),null!=s.DynamicIn&&(o.DynamicIn=s.DynamicIn),null!=s.DynamicOut&&(o.DynamicOut=s.DynamicOut),null!=s.HelpLink&&(o.HelpLink=s.HelpLink),null!=s.EnableConfig&&(o.EnableConfig=s.EnableConfig),null!=s.UiHint&&(o.UiHint=s.UiHint)),o||(o=Object.assign({},R.Unknown)),t[n.EntityGuid]=o}return t}var Oe=c(8352),Qe=c(1130),Me=c(7294);function we(i,a){1&i&&(e.TgZ(0,"app-field-hint"),e._uU(1," You will get suggestions for out-streams after you run query "),e.qZA())}function ke(i,a){1&i&&(e.TgZ(0,"app-field-hint",12),e._uU(1," This field is required "),e.qZA()),2&i&&e.Q6J("isError",!0)}function Re(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-form-field",9)(2,"mat-label"),e._uU(3,"Label"),e.qZA(),e._UZ(4,"input",10),e.qZA(),e.YNc(5,we,2,0,"app-field-hint",5),e.YNc(6,ke,2,1,"app-field-hint",11),e.BQk()),2&i){const t=e.oxw();e.xp6(5),e.Q6J("ngIf",t.isSource&&!t.pipelineResultExists),e.xp6(1),e.Q6J("ngIf",t.controls.label.touched&&(null==t.controls.label.errors?null:t.controls.label.errors.required))}}function Ue(i,a){if(1&i&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.name," ")}}function Ne(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-form-field",9)(2,"mat-label"),e._uU(3,"Scope"),e.qZA(),e.TgZ(4,"mat-select",18),e.YNc(5,Ue,2,2,"mat-option",19),e.qZA()(),e.TgZ(6,"app-field-hint"),e._uU(7," The scope should almost never be changed - "),e.TgZ(8,"a",20),e._uU(9,"see help"),e.qZA()(),e.BQk()),2&i){const t=e.oxw(2);e.xp6(4),e.Q6J("placeholder",t.scopeOptions.length?"":"No items found"),e.xp6(1),e.Q6J("ngForOf",t.scopeOptions)}}function $e(i,a){if(1&i&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function qe(i,a){if(1&i&&(e.TgZ(0,"mat-select",22),e.YNc(1,$e,2,2,"mat-option",19),e.qZA()),2&i){const t=e.oxw(2);e.Q6J("placeholder",t.labelOptions.length?"":"No items found"),e.xp6(1),e.Q6J("ngForOf",t.labelOptions)}}function Je(i,a){1&i&&e._UZ(0,"input",10)}function Fe(i,a){1&i&&(e.TgZ(0,"app-field-hint",12),e._uU(1," This field is required "),e.qZA()),2&i&&e.Q6J("isError",!0)}const K=function(i){return{active:i}};function Le(i,a){if(1&i){const t=e.EpF();e.ynx(0),e.YNc(1,Ne,10,2,"ng-container",5),e.TgZ(2,"mat-form-field",9)(3,"mat-label"),e._uU(4,"Label"),e.qZA(),e.YNc(5,qe,2,2,"mat-select",13),e.YNc(6,Je,1,0,"input",14),e.TgZ(7,"div",15)(8,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().toggleGuidedLabel(!0)}),e.TgZ(9,"mat-icon"),e._uU(10,"search"),e.qZA()(),e.TgZ(11,"button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().toggleGuidedLabel(!1)}),e.TgZ(12,"mat-icon"),e._uU(13,"text_fields"),e.qZA()()()(),e.YNc(14,Fe,2,1,"app-field-hint",11),e.BQk()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.advancedMode&&t.guidedLabel),e.xp6(4),e.Q6J("ngIf",t.guidedLabel),e.xp6(1),e.Q6J("ngIf",!t.guidedLabel),e.xp6(2),e.Q6J("ngClass",e.VKq(6,K,t.guidedLabel)),e.xp6(3),e.Q6J("ngClass",e.VKq(8,K,!t.guidedLabel)),e.xp6(3),e.Q6J("ngIf",t.controls.label.touched&&(null==t.controls.label.errors?null:t.controls.label.errors.required))}}function Ye(i,a){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-slide-toggle",23),e.NdJ("change",function(o){return e.CHM(t),e.oxw().toggleAdvancedMode(o)}),e._uU(2),e.qZA(),e._UZ(3,"div",24),e.BQk()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("checked",t.advancedMode),e.xp6(1),e.hij(" ",t.advancedMode?"Advanced":"Simple"," ")}}let Ge=(()=>{class i{constructor(t,n,o,s,r){this.dialogData=t,this.dialogRef=n,this.visualQueryService=o,this.contentTypesService=s,this.changeDetectorRef=r,this.hostClass="dialog-component",this.isSource=this.dialogData.isSource,this.pipelineResultExists=null!=this.visualQueryService.pipelineResult,this.scopeOptions=[],this.labelOptions=[],this.guidedLabel=!0,this.advancedMode=!1,this.subscription=new J.w0}ngOnInit(){this.buildForm()}ngOnDestroy(){this.subscription.unsubscribe()}closeDialog(t){this.dialogRef.close(t)}toggleGuidedLabel(t){this.guidedLabel=t}toggleAdvancedMode(t){this.advancedMode=t.checked}rename(){const t=this.form.getRawValue();this.closeDialog(t.label)}buildForm(){this.form=new _.cw({label:new _.NI(this.dialogData.label,_.kI.required),scope:new _.NI(h.Z.scopes.default.value)}),this.controls=this.form.controls,this.isSource&&this.pipelineResultExists&&(this.subscription.add(this.controls.scope.valueChanges.pipe((0,X.O)(this.controls.scope.value),(0,z.x)()).subscribe(t=>{this.labelOptions=Object.values(this.visualQueryService.pipelineResult.Sources).find(n=>n.Guid===this.dialogData.pipelineDataSourceGuid).Out.filter(n=>n.Scope===t).map(n=>n.Name),!this.labelOptions.includes(this.controls.label.value)&&null!=this.controls.label.value&&this.controls.label.patchValue(null)})),this.contentTypesService.getScopes().subscribe(t=>{const n=Object.values(this.visualQueryService.pipelineResult.Sources).find(s=>s.Guid===this.dialogData.pipelineDataSourceGuid).Out,o=t.filter(s=>n.some(r=>r.Scope===s.value));this.scopeOptions=o,this.changeDetectorRef.markForCheck()}))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(v.WI),e.Y36(v.so),e.Y36(D),e.Y36(Z.sF),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-rename-stream"]],hostVars:1,hostBindings:function(t,n){2&t&&e.Ikx("className",n.hostClass)},decls:17,vars:5,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content","fancy-scrollbar-light"],[4,"ngIf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["appearance","standard","color","accent"],["matInput","","type","text","formControlName","label","required",""],[3,"isError",4,"ngIf"],[3,"isError"],["formControlName","label","required","",3,"placeholder",4,"ngIf"],["matInput","","type","text","formControlName","label","required","",4,"ngIf"],["matSuffix","",1,"selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",3,"ngClass","click"],["mat-icon-button","","type","button","tippy","Manual entry",3,"ngClass","click"],["formControlName","scope",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],[3,"value"],["formControlName","label","required","",3,"placeholder"],["color","accent",3,"checked","change"],[1,"spacer"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div"),e._uU(3,"Rename stream"),e.qZA(),e.TgZ(4,"button",2),e.NdJ("click",function(){return n.closeDialog()}),e.TgZ(5,"mat-icon"),e._uU(6,"close"),e.qZA()()()(),e.TgZ(7,"form",3)(8,"div",4),e.YNc(9,Re,7,2,"ng-container",5),e.YNc(10,Le,15,10,"ng-container",5),e.qZA(),e.TgZ(11,"div",6),e.YNc(12,Ye,4,2,"ng-container",5),e.TgZ(13,"button",7),e.NdJ("click",function(){return n.closeDialog()}),e._uU(14,"Cancel"),e.qZA(),e.TgZ(15,"button",8),e.NdJ("click",function(){return n.rename()}),e._uU(16," Rename "),e.qZA()()()),2&t&&(e.xp6(7),e.Q6J("formGroup",n.form),e.xp6(2),e.Q6J("ngIf",!n.isSource||!n.pipelineResultExists),e.xp6(1),e.Q6J("ngIf",n.isSource&&n.pipelineResultExists),e.xp6(2),e.Q6J("ngIf",n.isSource&&n.pipelineResultExists),e.xp6(3),e.Q6J("disabled",!n.form.valid))},directives:[v.uh,P.lW,E.$,T.Hw,_._Y,_.JL,_.sg,m.O5,Q.KE,Q.hX,G.Nt,_.Fj,_.JJ,_.u,_.Q7,Oe.Y,H.gD,m.sg,Qe.ey,Me.E,Q.R9,m.mk,A.Rr],styles:[""]}),i})();const g="dataSource_";class He{constructor(a,t,n,o,s,r,l,u,p){this.jsPlumbRoot=a,this.pipelineModel=t,this.dataSources=n,this.onConnectionsChanged=o,this.onDragend=s,this.onDebugStream=r,this.dialog=l,this.viewContainerRef=u,this.changeDetectorRef=p,this.lineCount=0,this.linePaintDefault={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.lineColors=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.maxCols=this.lineColors.length-1,this.uuidColorMap={},this.bulkDelete=!1,this.instance=window.jsPlumb.getInstance(this.getInstanceDefaults(this.jsPlumbRoot)),this.instance.batch(()=>{this.initDomDataSources(),this.initWirings(),this.bindEvents()}),this.instance.repaintEverything()}destroy(){var a;null===(a=this.dialogRef)||void 0===a||a.close(),this.instance.reset(),this.instance.unbindContainer()}removeEndpointsOnDataSource(a){const t=g+a;this.bulkDelete=!0,this.instance.batch(()=>{this.instance.selectEndpoints({element:t}).delete()}),this.bulkDelete=!1}getAllConnections(){return this.instance.getAllConnections().map(t=>({From:t.sourceId.replace(g,""),Out:t.endpoints[0].getOverlay("endpointLabel").label,To:t.targetId.replace(g,""),In:t.endpoints[1].getOverlay("endpointLabel").label}))}getStreamsOut(){const a=[];return this.instance.selectEndpoints({target:g+"Out"}).each(n=>{a.push(n.getOverlay("endpointLabel").label)}),a.join(",")}putEntityCountOnConnections(a){var t;null===(t=a.Streams)||void 0===t||t.forEach(n=>{var o,s;const r=g+n.Source,d=(["00000000-0000-0000-0000-000000000000",this.pipelineModel.Pipeline.EntityGuid].includes(n.Target)?g+"Out":g+n.Target)+"_in_"+n.TargetIn,f=this.instance.getEndpoint(r+"_out_"+n.SourceOut);null===(s=null===(o=null==f?void 0:f.connections)||void 0===o?void 0:o.filter(x=>x.endpoints[1].getUuid()===d))||void 0===s||s.forEach(x=>{const U=n.Error?"":n.Count.toString();x.setLabel({label:U,cssClass:"streamEntitiesCount "+(n.Error?"streamEntitiesError":""),events:{click:$=>{!this.pipelineModel.Pipeline.AllowEdit||this.onDebugStream(n)}}})})})}nextLinePaintStyle(a){return this.uuidColorMap[a]||(this.uuidColorMap[a]=Object.assign({},this.linePaintDefault,{stroke:this.lineColors[this.lineCount++%this.maxCols]}))}getInstanceDefaults(a){return{Container:a,Connector:["Bezier",{curviness:70}],PaintStyle:this.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}}initDomDataSources(){var a,t;for(const n of this.pipelineModel.DataSources){const o=this.jsPlumbRoot.querySelector("#"+g+n.EntityGuid);if(!o)continue;const s=this.dataSources.find(r=>r.PartAssemblyAndType===n.PartAssemblyAndType);if(s){if(this.pipelineModel.Pipeline.AllowEdit&&this.instance.draggable(o,{grid:[20,20],stop:r=>{const u=r.el.id.replace(g,""),p={Top:r.finalPos[1],Left:r.finalPos[0]};setTimeout(()=>{this.onDragend(u,p)})}}),null===(a=s.Out)||void 0===a||a.forEach(r=>{this.addEndpoint(o,r,!1,n)}),null===(t=s.In)||void 0===t||t.forEach(r=>{this.addEndpoint(o,r,!0,n)}),s.In){const r=this.buildTargetEndpoint(n.EntityGuid);r.maxConnections=-1,this.instance.makeTarget(o,r)}s.DynamicOut&&this.instance.makeSource(o,this.buildSourceEndpoint(n.EntityGuid),{filter:".add-endpoint"})}}}initWirings(){var a;null===(a=this.pipelineModel.Pipeline.StreamWiring)||void 0===a||a.forEach(t=>{const n=g+t.From,o=n+"_out_"+t.Out,s=g+t.To,r=s+"_in_"+t.In;if(!this.instance.getEndpoint(o)){const l=this.jsPlumbRoot.querySelector("#"+n);if(!l)return;const u=l.id.replace(g,""),p=this.pipelineModel.DataSources.find(d=>d.EntityGuid===u);this.addEndpoint(l,t.Out,!1,p)}if(!this.instance.getEndpoint(r)){const l=this.jsPlumbRoot.querySelector("#"+s);if(!l)return;const u=l.id.replace(g,""),p=this.pipelineModel.DataSources.find(d=>d.EntityGuid===u);this.addEndpoint(l,t.In,!0,p)}try{this.instance.connect({uuids:[o,r],paintStyle:this.nextLinePaintStyle(o)})}catch(l){console.error({message:"Connection failed",from:o,to:r})}})}addEndpoint(a,t,n,o){var s,r,l;const u=this.dataSources.find(C=>C.PartAssemblyAndType===o.PartAssemblyAndType),p=n?!(null===(s=u.In)||void 0===s?void 0:s.some(C=>this.getEndpointInfo(C,!1))):!(null===(r=u.Out)||void 0===r?void 0:r.some(C=>this.getEndpointInfo(C,!1))),d=this.getEndpointInfo(t,p);let f;f=p?"dynamic":d.required?(null===(l=this.pipelineModel.Pipeline.StreamWiring)||void 0===l?void 0:l.some(ne=>g+ne.To===a.id&&ne.In===d.name))?"":"required":"";const x=a.id+(n?"_in_":"_out_")+d.name,U=n?this.buildTargetEndpoint(o.EntityGuid,f):this.buildSourceEndpoint(o.EntityGuid,f);this.instance.addEndpoint(a,U,{uuid:x,enabled:this.pipelineModel.Pipeline.AllowEdit||o.EntityGuid===h.Z.pipelineDesigner.outDataSource.EntityGuid}).getOverlay("endpointLabel").setLabel(d.name)}buildSourceEndpoint(a,t){var n;return{paintStyle:{fill:"transparent",radius:10},cssClass:null!==(n="sourceEndpoint "+t)&&void 0!==n?n:"",maxConnections:-1,isSource:!0,anchor:["Continuous",{faces:["top"]}],overlays:this.getEndpointOverlays(!0),events:{click:r=>{this.onChangeLabel(r,!0,a)}}}}buildTargetEndpoint(a,t){var n;return{paintStyle:{fill:"transparent",radius:10},cssClass:null!==(n="targetEndpoint "+t)&&void 0!==n?n:"",maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.getEndpointOverlays(!1),dropOptions:{hoverClass:"hover",activeClass:"active"},events:{click:r=>{this.onChangeLabel(r,!1,a)}}}}getEndpointOverlays(a){return[["Label",{id:"endpointLabel",location:[.5,a?0:1],label:"Default",cssClass:a?"endpointSourceLabel":"endpointTargetLabel"}]]}onChangeLabel(a,t,n){if(!this.pipelineModel.Pipeline.AllowEdit)return;const o=a.getOverlay?a.getOverlay("endpointLabel"):a;this.dialogRef=this.dialog.open(Ge,{autoFocus:!1,data:{pipelineDataSourceGuid:n,isSource:t,label:o.label},viewContainerRef:this.viewContainerRef,width:"650px"}),this.dialogRef.afterClosed().subscribe(r=>{!r||(o.setLabel(r),setTimeout(()=>{this.onConnectionsChanged()}))}),this.changeDetectorRef.markForCheck()}bindEvents(){this.instance.bind("connectionDetached",a=>{if(this.bulkDelete)return;const t=a.target,n=this.pipelineModel.DataSources.find(l=>l.EntityGuid===t.id.replace(g,"")),o=this.dataSources.find(l=>l.PartAssemblyAndType===n.PartAssemblyAndType),s=a.targetEndpoint.getOverlay("endpointLabel").label;o.In.some(l=>this.getEndpointInfo(l,!1).name===s)||this.instance.deleteEndpoint(a.targetEndpoint),setTimeout(()=>{this.onConnectionsChanged()})}),this.instance.bind("connection",a=>{if(a.sourceId===a.targetId)return void setTimeout(()=>{this.instance.deleteConnection(a.connection,{fireEvent:!1}),setTimeout(()=>{this.onConnectionsChanged()})});const t=a.targetEndpoint.getOverlay("endpointLabel"),n=t.getLabel();this.instance.getEndpoints(a.target.id).some(r=>r.getOverlay("endpointLabel").getLabel()===n&&a.targetEndpoint.id!==r.id&&r.canvas.classList.contains("targetEndpoint"))&&t.setLabel(`PleaseRename${Math.floor(99999*Math.random())}`),setTimeout(()=>{this.onConnectionsChanged()})})}getEndpointInfo(a,t){let n,o;if(t)n=a,o=!1;else{const r=a.trim();o=r.endsWith("*"),n=o?r.substring(0,r.length-1):r}return{name:n,required:o}}}var je=c(4240);const Be=["domRoot"],Ve=["domDataSource"];function We(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-icon",19),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit;return e.oxw(3).configureDataSource(o)}),e._uU(1," settings "),e.qZA()}}function ze(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-icon",20),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,s=e.oxw(2).ngIf;return e.oxw().openHelp(s.typeInfos[o.EntityGuid].HelpLink)}),e._uU(1," help_outline "),e.qZA()}}function Xe(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-icon",21),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit;return e.oxw(3).remove(o)}),e._uU(1," delete "),e.qZA()}}function Ke(i,a){if(1&i&&(e.TgZ(0,"tr",25)(1,"td",26),e._uU(2),e.qZA(),e.TgZ(3,"td",27),e._uU(4),e.qZA()()),2&i){const t=a.$implicit;e.xp6(1),e.Q6J("title",t.name),e.xp6(1),e.Oqu(t.name),e.xp6(1),e.Q6J("title",t.value),e.xp6(1),e.Oqu(t.value)}}function et(i,a){if(1&i&&(e.ynx(0),e._UZ(1,"hr",22),e.TgZ(2,"table",23),e.YNc(3,Ke,5,4,"tr",24),e.qZA(),e.BQk()),2&i){const t=e.oxw().$implicit,n=e.oxw(2).ngIf;e.xp6(3),e.Q6J("ngForOf",n.dataSourceConfigs[t.EntityId])}}function tt(i,a){1&i&&e._UZ(0,"div",28)}function nt(i,a){1&i&&e._UZ(0,"div",29)}const it=function(i,a,t){return{top:i,left:a,"min-width":t}},ot=function(i){return{"show-details":i}};function at(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",5,6)(2,"div",7)(3,"mat-icon",8),e._uU(4),e.qZA(),e.YNc(5,We,2,0,"mat-icon",9),e.YNc(6,ze,2,0,"mat-icon",10),e.qZA(),e.TgZ(7,"div",11),e.YNc(8,Xe,2,0,"mat-icon",12),e.qZA(),e.TgZ(9,"div",13),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw(2).ngIf,l=e.oxw();return r.allowEdit&&l.editName(s)}),e.TgZ(10,"span"),e._uU(11),e.qZA(),e.TgZ(12,"mat-icon",14),e._uU(13,"edit"),e.qZA()(),e._UZ(14,"br"),e.TgZ(15,"div",15),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw(2).ngIf,l=e.oxw();return r.allowEdit&&l.editDescription(s)}),e.TgZ(16,"span"),e._uU(17),e.qZA(),e.TgZ(18,"mat-icon",14),e._uU(19,"edit"),e.qZA()(),e._UZ(20,"br"),e.YNc(21,et,4,1,"ng-container",3),e.TgZ(22,"div",16),e._uU(23),e.qZA(),e.YNc(24,tt,1,0,"div",17),e.YNc(25,nt,1,0,"div",18),e.qZA()}if(2&i){const t=a.$implicit,n=e.oxw(2).ngIf,o=e.oxw();e.Q6J("id",o.dataSrcIdPrefix+t.EntityGuid)("ngStyle",e.kEZ(15,it,t.VisualDesignerData.Top+"px",t.VisualDesignerData.Left+"px",t.VisualDesignerData.Width?t.VisualDesignerData.Width+"px":null))("ngClass",e.VKq(19,ot,n.showDataSourceDetails&&(null==n.dataSourceConfigs[t.EntityId]?null:n.dataSourceConfigs[t.EntityId].length))),e.xp6(3),e.Q6J("title",n.typeInfos[t.EntityGuid].UiHint),e.xp6(1),e.hij(" ",n.typeInfos[t.EntityGuid].Icon," "),e.xp6(1),e.Q6J("ngIf",n.allowEdit&&n.typeInfos[t.EntityGuid].EnableConfig),e.xp6(1),e.Q6J("ngIf",n.typeInfos[t.EntityGuid].HelpLink),e.xp6(2),e.Q6J("ngIf",n.allowEdit&&!o.isOutDataSource(t)),e.xp6(3),e.Oqu(t.Name||"(no name)"),e.xp6(6),e.Oqu(t.Description),e.xp6(4),e.Q6J("ngIf",n.showDataSourceDetails&&(null==n.dataSourceConfigs[t.EntityId]?null:n.dataSourceConfigs[t.EntityId].length)),e.xp6(1),e.Q6J("title",t.PartAssemblyAndType),e.xp6(1),e.hij(" Type: ",o.getTypeName(t.PartAssemblyAndType)," "),e.xp6(1),e.Q6J("ngIf",n.allowEdit&&n.typeInfos[t.EntityGuid].DynamicOut),e.xp6(1),e.Q6J("ngIf",n.allowEdit&&n.typeInfos[t.EntityGuid].DynamicIn)}}function st(i,a){if(1&i&&(e.ynx(0),e.YNc(1,at,26,21,"div",4),e.BQk()),2&i){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t.pipelineDataSources)}}function rt(i,a){if(1&i&&(e.TgZ(0,"div",1,2),e.YNc(2,st,2,1,"ng-container",3),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.hardReset)}}let ee=(()=>{class i{constructor(t,n,o,s,r){this.visualQueryService=t,this.queryDefinitionService=n,this.changeDetectorRef=o,this.dialog=s,this.viewContainerRef=r,this.dataSrcIdPrefix=g,this.hardReset=!1,this.scriptLoaded$=new I.X(!1),this.subscription=new J.w0}ngOnInit(){(0,re.y)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],()=>{this.scriptLoaded$.next(!0)}),this.subscription.add(this.visualQueryService.putEntityCountOnConnections$.subscribe(n=>{this.plumber.putEntityCountOnConnections(n)}));const t=this.visualQueryService.pipelineModel$.pipe((0,y.U)(n=>{var o;return null!==(o=O.iX.tryParse(null==n?void 0:n.Pipeline.VisualDesignerData))&&void 0!==o?o:{}}),(0,z.x)(O.iX.objectsEqual));this.templateModel$=(0,F.a)([this.visualQueryService.pipelineModel$,this.visualQueryService.dataSources$,t,this.visualQueryService.dataSourceConfigs$]).pipe((0,y.U)(([n,o,s,r])=>{var l;return null==n||null==o?void 0:(this.hardReset=!0,this.changeDetectorRef.detectChanges(),this.hardReset=!1,{pipelineDataSources:n.DataSources,typeInfos:Ie(n.DataSources,o),allowEdit:n.Pipeline.AllowEdit,showDataSourceDetails:null!==(l=s.ShowDataSourceDetails)&&void 0!==l&&l,dataSourceConfigs:r})}))}ngAfterViewInit(){const t=this.domDataSourcesRef.changes.pipe((0,y.U)(()=>!0));this.subscription.add((0,F.a)([this.scriptLoaded$,t]).subscribe(([n,o])=>{var s;!n||!o||(null===(s=this.plumber)||void 0===s||s.destroy(),this.plumber=new He(this.domRootRef.nativeElement,this.visualQueryService.pipelineModel$.value,this.visualQueryService.dataSources$.value,this.onConnectionsChanged.bind(this),this.onDragend.bind(this),this.onDebugStream.bind(this),this.dialog,this.viewContainerRef,this.changeDetectorRef))}))}ngOnDestroy(){var t;null===(t=this.plumber)||void 0===t||t.destroy(),this.scriptLoaded$.complete(),this.subscription.unsubscribe()}onConnectionsChanged(){const t=this.plumber.getAllConnections(),n=this.plumber.getStreamsOut();this.visualQueryService.changeConnections(t,n)}onDragend(t,n){this.visualQueryService.changeDataSourcePosition(t,n)}onDebugStream(t){this.visualQueryService.debugStream(t)}configureDataSource(t){t.EntityGuid.includes("unsaved")?this.visualQueryService.saveAndRun(!0,!1):this.visualQueryService.editDataSource(t)}getTypeName(t){const n=this.visualQueryService.dataSources$.value.find(o=>o.PartAssemblyAndType===t);return this.queryDefinitionService.typeNameFilter((null==n?void 0:n.TypeNameForUi)||t,"className")}isOutDataSource(t){return t.PartAssemblyAndType===h.Z.pipelineDesigner.outDataSource.PartAssemblyAndType}remove(t){if(!confirm(`Delete ${t.Name} data source?`))return;this.plumber.removeEndpointsOnDataSource(t.EntityGuid);const n=this.plumber.getAllConnections(),o=this.plumber.getStreamsOut();this.visualQueryService.removeDataSource(t.EntityGuid,n,o)}openHelp(t){window.open(t,"_blank")}editName(t){var n;const o=null===(n=prompt("Rename data source",t.Name))||void 0===n?void 0:n.trim();null==o||""===o||this.visualQueryService.renameDataSource(t.EntityGuid,o)}editDescription(t){var n;const o=null===(n=prompt("Edit description",t.Description))||void 0===n?void 0:n.trim();null!=o&&this.visualQueryService.changeDataSourceDescription(t.EntityGuid,o)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(q),e.Y36(e.sBO),e.Y36(v.uw),e.Y36(e.s_b))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-plumb-editor"]],viewQuery:function(t,n){if(1&t&&(e.Gf(Be,5),e.Gf(Ve,5)),2&t){let o;e.iGM(o=e.CRH())&&(n.domRootRef=o.first),e.iGM(o=e.CRH())&&(n.domDataSourcesRef=o)}},decls:2,vars:3,consts:[["id","pipeline-root",4,"ngIf"],["id","pipeline-root"],["domRoot",""],[4,"ngIf"],["class","dataSource",3,"id","ngStyle","ngClass",4,"ngFor","ngForOf"],[1,"dataSource",3,"id","ngStyle","ngClass"],["domDataSource",""],[1,"actions","left"],[1,"type-info",3,"title"],["class","configure","title","Configure data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],["class","help","title","Help for this data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],[1,"actions","right"],["class","delete","title","Delete","appMousedownStopPropagation","",3,"click",4,"ngIf"],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["class","add-endpoint sourceEndpoint dynamic","title","Drag a new Out-Connection",4,"ngIf"],["class","many-in targetEndpoint dynamic","title","This data source supports multiple In-Connections",4,"ngIf"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],[2,"margin","0"],[1,"configs"],["class","config",4,"ngFor","ngForOf"],[1,"config"],[1,"config-name",3,"title"],[1,"config-value",3,"title"],["title","Drag a new Out-Connection",1,"add-endpoint","sourceEndpoint","dynamic"],["title","This data source supports multiple In-Connections",1,"many-in","targetEndpoint","dynamic"]],template:function(t,n){1&t&&(e.YNc(0,rt,3,1,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,n.templateModel$))},directives:[m.O5,m.sg,m.PC,m.mk,T.Hw,je.d],pipes:[m.Ov],styles:["","[_nghost-%COMP%]{display:block;width:100%;height:100%}\n/*# sourceMappingURL=https://sources.2sxc.org/14.12.00/ng-edit/C:/Projects/2sxc/eav-ui/projects/eav-ui/src/app/visual-query/plumb-editor/plumb-editor.component.ts-angular-inline--1.css.map*/"]}),i})();function ut(i,a){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.xp6(1),e.hij(" ",t," ")}}function pt(i,a){if(1&i&&(e.TgZ(0,"ul",15),e.YNc(1,ut,2,1,"li",16),e.qZA()),2&i){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",null==t.Pipeline.Params?null:t.Pipeline.Params.split("\n"))}}function dt(i,a){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.xp6(1),e.hij(" ",t," ")}}function mt(i,a){if(1&i&&(e.TgZ(0,"ul",15),e.YNc(1,dt,2,1,"li",16),e.qZA()),2&i){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",null==t.Pipeline.TestParameters?null:t.Pipeline.TestParameters.split("\n"))}}function gt(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",6)(1,"mat-slide-toggle",17),e.NdJ("change",function(o){return e.CHM(t),e.oxw(2).showDataSourceDetails(o)}),e._uU(2," Show DataSource Params "),e.qZA()()}if(2&i){const t=a.ngIf;e.xp6(1),e.Q6J("checked",t.ShowDataSourceDetails)}}function ft(i,a){1&i&&e._UZ(0,"li",22),2&i&&e.Q6J("innerHTML",a.$implicit,e.oJD)}function ht(i,a){if(1&i&&(e.TgZ(0,"div",19)(1,"div",7)(2,"span"),e._uU(3,"Warnings"),e.qZA(),e.TgZ(4,"mat-icon",20),e._uU(5,"warning"),e.qZA()(),e.TgZ(6,"ol",15),e.YNc(7,ft,1,1,"li",21),e.qZA()()),2&i){const t=e.oxw().ngIf;e.xp6(7),e.Q6J("ngForOf",t)}}function _t(i,a){if(1&i&&(e.ynx(0),e.YNc(1,ht,8,1,"div",18),e.BQk()),2&i){const t=a.ngIf;e.xp6(1),e.Q6J("ngIf",t.length)}}function vt(i,a){if(1&i&&(e.TgZ(0,"div",23)(1,"div",7),e._uU(2,"Query Description"),e.qZA(),e.TgZ(3,"div"),e._uU(4),e.qZA()()),2&i){const t=e.oxw().ngIf;e.xp6(4),e.Oqu(t.Pipeline.Description)}}function yt(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),e.NdJ("click",function(){return e.CHM(t),e.oxw().saveAndRunQuery(!0,!0)}),e._uU(4," Save and run "),e.qZA(),e.TgZ(5,"button",5),e.NdJ("click",function(){return e.CHM(t),e.oxw().saveAndRunQuery(!1,!0)}),e._uU(6," Run "),e.qZA(),e.TgZ(7,"button",5),e.NdJ("click",function(){return e.CHM(t),e.oxw().saveAndRunQuery(!0,!1)}),e._uU(8," Save "),e.qZA()(),e.TgZ(9,"div",6)(10,"div",7)(11,"div"),e._uU(12,"Query Parameters"),e.qZA(),e.TgZ(13,"div")(14,"button",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().editPipeline()}),e.TgZ(15,"mat-icon"),e._uU(16,"edit"),e.qZA()(),e.TgZ(17,"button",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().openParamsHelp()}),e.TgZ(18,"mat-icon"),e._uU(19,"info"),e.qZA()()()(),e.YNc(20,pt,2,1,"ul",10),e.qZA(),e.TgZ(21,"div",6)(22,"div",7),e._uU(23,"Test Parameters"),e.qZA(),e.YNc(24,mt,2,1,"ul",10),e.qZA(),e.YNc(25,gt,3,1,"div",11),e.ALo(26,"async"),e.YNc(27,_t,2,1,"ng-container",12),e.ALo(28,"async"),e.YNc(29,vt,5,1,"div",13),e.TgZ(30,"div",14)(31,"button",5),e.NdJ("click",function(){return e.CHM(t),e.oxw().openRestApi()}),e.TgZ(32,"span"),e._uU(33,"Use in JSON / REST API"),e.qZA(),e.TgZ(34,"mat-icon"),e._uU(35,"code_curly"),e.qZA()()()()()}if(2&i){const t=a.ngIf,n=e.oxw();e.xp6(20),e.Q6J("ngIf",null==t.Pipeline.Params?null:t.Pipeline.Params.length),e.xp6(4),e.Q6J("ngIf",null==t.Pipeline.TestParameters?null:t.Pipeline.TestParameters.length),e.xp6(1),e.Q6J("ngIf",e.lcZ(26,5,n.visualDesignerData$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(28,7,n.warnings$)),e.xp6(2),e.Q6J("ngIf",t.Pipeline.Description)}}let xt=(()=>{class i{constructor(t,n,o,s){this.router=t,this.route=n,this.context=o,this.visualQueryService=s}ngOnInit(){this.pipelineModel$=this.visualQueryService.pipelineModel$.asObservable(),this.warnings$=this.visualQueryService.pipelineModel$.pipe((0,y.U)(t=>function ct(i,a){var t,n;const o=[];try{const s=(null===(t=i.Pipeline.Params)||void 0===t?void 0:t.split(/\r?\n/))||[],r=(null===(n=i.Pipeline.TestParameters)||void 0===n?void 0:n.split(/\r?\n/))||[];s.forEach(l=>{(l=null==l?void 0:l.trim())&&(/^[a-zA-Z0-9]+=(.*)$/gim.test(l)||o.push(`\n          A <em>Query Parameter</em> seems wrong: <br>\n          <code>${l}</code> <br>\n          It should use the syntax: <br>\n          <code>key=value</code> <br>\n          or resolve to a token like: <br>\n          <code>key=[source:key]</code>\n        `))}),r.forEach(l=>{var u;if(!(l=null==l?void 0:l.trim()))return;/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gim.test(l)||o.push(`\n          A <em>Test Parameter</em> seems wrong: <br>\n          <code>${l}</code> <br>\n          It should use the syntax: <br>\n          <code>[source:key]=value</code>\n        `);const x=/^\[module:id\]=([0-9]*)$/gim.exec(l);if(x){const $=x[1],C=null===(u=a.moduleId)||void 0===u?void 0:u.toString();$!==C&&o.push(`\n            Your test ModuleId (${$}) is different from the current ModuleId (${C}).<br>\n            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it\n          `)}/^\[module:moduleid\]=([0-9]*)$/gim.exec(l)&&o.push("\n          You are using deprecated [Module:ModuleId] test parameter.<br>\n          Please use [Module:Id]\n        ")})}catch(s){console.error("Something went wrong in calculateWarnings for params",s)}return o}(t,this.context))),this.visualDesignerData$=this.visualQueryService.pipelineModel$.pipe((0,y.U)(t=>{var n;return null!==(n=O.iX.tryParse(t.Pipeline.VisualDesignerData))&&void 0!==n?n:{}}))}editPipeline(){this.visualQueryService.editPipelineEntity()}openParamsHelp(){window.open("http://r.2sxc.org/QueryParams","_blank")}saveAndRunQuery(t,n){this.visualQueryService.saveAndRun(t,n)}showDataSourceDetails(t){this.visualQueryService.showDataSourceDetails(t.checked)}openRestApi(){this.router.navigate([W.ii.getUrlQuery(this.visualQueryService.pipelineModel$.value.Pipeline.EntityGuid)],{relativeTo:this.route})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b.F0),e.Y36(b.gz),e.Y36(w._),e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-run-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],["class","values",4,"ngIf"],["class","parameters",4,"ngIf"],[4,"ngIf"],["class","description",4,"ngIf"],[1,"footer-actions"],[1,"values"],[4,"ngFor","ngForOf"],["color","primary","labelPosition","before",3,"checked","change"],["class","warnings",4,"ngIf"],[1,"warnings"],[2,"color","red"],[3,"innerHTML",4,"ngFor","ngForOf"],[3,"innerHTML"],[1,"description"]],template:function(t,n){1&t&&(e.YNc(0,yt,36,9,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,n.pipelineModel$))},directives:[m.O5,P.lW,E.$,T.Hw,m.sg,A.Rr],pipes:[m.Ov],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{margin:16px 0}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}"]}),i})();function St(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",8),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(4).addDataSource(s)}),e.TgZ(1,"mat-icon"),e._uU(2),e.qZA(),e.TgZ(3,"span"),e._uU(4),e.qZA()()}if(2&i){const t=a.$implicit,n=e.oxw(4);e.Q6J("tippy",t.UiHint||t.Name),e.xp6(2),e.Oqu(t.Icon||n.guiTypes.Unknown.Icon),e.xp6(2),e.Oqu(t.Name)}}function Ct(i,a){if(1&i&&(e.TgZ(0,"div",6),e.YNc(1,St,5,3,"div",7),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.value)("ngForTrackBy",n.trackDataSources)}}function Tt(i,a){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",4),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).toggleItem(s.key)}),e.TgZ(2,"mat-icon"),e._uU(3),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.qZA()(),e.YNc(6,Ct,2,2,"div",5),e.BQk()}if(2&i){const t=a.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("tippy",n.guiTypes[t.key].UiHint||t.key),e.xp6(2),e.Oqu(n.guiTypes[t.key].Icon||n.guiTypes.Unknown.Icon),e.xp6(2),e.Oqu(t.key),e.xp6(1),e.Q6J("ngIf",n.toggledItems.includes(t.key))}}function Dt(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"mat-slide-toggle",2),e.NdJ("change",function(o){return e.CHM(t),e.oxw().toggleDifficulty(o)}),e._uU(2," Show Advanced "),e.qZA(),e.YNc(3,Tt,7,4,"ng-container",3),e.ALo(4,"keyvalue"),e.qZA()}if(2&i){const t=a.ngIf,n=e.oxw();e.xp6(3),e.Q6J("ngForOf",e.lcZ(4,2,t))("ngForTrackBy",n.trackGroups)}}let Zt=(()=>{class i{constructor(t){this.visualQueryService=t,this.toggledItems=[],this.guiTypes=R,this.difficulties=h.Z.pipelineDesigner.dataSourceDifficulties,this.difficulty$=new I.X(this.difficulties.default)}ngOnInit(){this.sorted$=(0,F.a)([this.visualQueryService.dataSources$,this.difficulty$]).pipe((0,y.U)(([t,n])=>function bt(i,a){if(!i)return;const n=(0,S.Z)(i).filter(s=>s.Difficulty<=a&&s.PartAssemblyAndType!==h.Z.pipelineDesigner.outDataSource.PartAssemblyAndType);n.sort((s,r)=>s.Name.toLocaleLowerCase().localeCompare(r.Name.toLocaleLowerCase()));const o={};for(const s of n){const r=s.PrimaryType;o[r]?o[r].push(s):o[r]=[s]}return o}(t,n)))}ngOnDestroy(){this.difficulty$.complete()}toggleDifficulty(t){this.difficulty$.next(t.checked?this.difficulties.advanced:this.difficulties.default)}addDataSource(t){this.visualQueryService.addDataSource(t)}toggleItem(t){O.iX.toggleInArray(t,this.toggledItems)}trackGroups(t,n){return n.key}trackDataSources(t,n){return n.PartAssemblyAndType}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-add-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],["labelPosition","before","color","primary",3,"change"],[4,"ngFor","ngForOf","ngForTrackBy"],["tippyShowDelay","750",1,"collapsible",3,"tippy","click"],["class","list",4,"ngIf"],[1,"list"],["class","list-item","tippyShowDelay","750",3,"tippy","click",4,"ngFor","ngForOf","ngForTrackBy"],["tippyShowDelay","750",1,"list-item",3,"tippy","click"]],template:function(t,n){1&t&&(e.YNc(0,Dt,5,4,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,n.sorted$))},directives:[m.O5,A.Rr,m.sg,E.$,T.Hw],pipes:[m.Ov,m.Nd],styles:[".mat-slide-toggle[_ngcontent-%COMP%]{margin:6px;-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;-webkit-user-select:none;user-select:none;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}"]}),i})();const te=function(i){return{active:i}},Et=[{path:"",component:(()=>{class i{constructor(t,n,o){this.context=t,this.route=n,this.visualQueryService=o,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}ngOnInit(){this.visualQueryService.init()}toggleExplorer(t){this.activeExplorer=this.activeExplorer===t?null:t}openHelp(){window.open("http://r.2sxc.org/visual-query","_blank")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(w._),e.Y36(b.gz),e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-visual-query"]],viewQuery:function(t,n){if(1&t&&e.Gf(ee,5),2&t){let o;e.iGM(o=e.CRH())&&(n.plumbEditor=o.first)}},features:[e._Bn([D])],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"ngClass","click"],["tippy","Add",1,"button",3,"ngClass","click"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(t,n){1&t&&(e._UZ(0,"router-outlet"),e.TgZ(1,"div",0)(2,"div",1)(3,"div",2),e.NdJ("click",function(){return n.toggleExplorer(n.explorer.run)}),e.TgZ(4,"mat-icon"),e._uU(5,"play_arrow"),e.qZA()(),e.TgZ(6,"div",3),e.NdJ("click",function(){return n.toggleExplorer(n.explorer.add)}),e.TgZ(7,"mat-icon"),e._uU(8,"add"),e.qZA()(),e._UZ(9,"div",4),e.TgZ(10,"div",5),e.NdJ("click",function(){return n.openHelp()}),e.TgZ(11,"mat-icon"),e._uU(12,"help_outline"),e.qZA()()(),e._UZ(13,"app-run-explorer",6)(14,"app-add-explorer",6)(15,"app-plumb-editor"),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngClass",e.VKq(4,te,n.activeExplorer===n.explorer.run)),e.xp6(3),e.Q6J("ngClass",e.VKq(6,te,n.activeExplorer===n.explorer.add)),e.xp6(7),e.Q6J("hidden",n.activeExplorer!==n.explorer.run),e.xp6(1),e.Q6J("hidden",n.activeExplorer!==n.explorer.add))},directives:[b.lC,E.$,m.mk,T.Hw,xt,Zt,ee],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),i})(),children:[W.ii.route,{matcher:se.eP,loadChildren:()=>Promise.all([c.e("default-projects_eav-ui_src_app_create-file-dialog_index_ts"),c.e("default-node_modules_angular_material_fesm2015_list_mjs"),c.e("default-projects_eav-ui_src_app_monaco-editor_index_ts-projects_eav-ui_src_app_shared_directi-e88d8b"),c.e("default-projects_eav-ui_src_app_edit_edit_module_ts"),c.e("default-projects_eav-ui_src_app_shared_translation_translate-configuration_ts-projects_eav-ui-de1a04"),c.e("default-node_modules_angular_material_fesm2015_autocomplete_mjs"),c.e("default-node_modules_angular_material_fesm2015_menu_mjs"),c.e("node_modules_angular_material_fesm2015_card_mjs")]).then(c.bind(c,7155)).then(i=>i.EditModule),data:{history:!1}}]}];let Pt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[b.Bz.forChild(Et)],b.Bz]}),i})(),At=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[w._,q,V.D,B.s],imports:[[m.ez,ie.q,Pt,T.Ps,P.ot,A.rP,j.ZX,v.Is,M.Nh,Q.lN,_.UX,H.LD,G.c,A.rP]]}),i})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/14.12.00/ng-edit/projects_eav-ui_src_app_visual-query_visual-query_module_ts.514dd580dd20d2db.js.map