(()=>{"use strict";var t={309:(t,n,e)=>{e.d(n,{MF:()=>o,RY:()=>r,sv:()=>C,vQ:()=>w,qb:()=>c,kf:()=>f,nr:()=>x,cM:()=>u,kX:()=>i});var r="turn-on",o="turn-on-skip",i="window",s="turn-on: ";function u(t,n,e){window.debugTurnOn&&(e?console.log(s+t,n,e):n?console.log(s+t,n):console.log(s+t))}var a,c=function(t,n,e,r,o){void 0===r&&(r="not set"),this.type=t,this.ready=n,this.message=e,this.name=r,this.result=o,this.attempts=0},l=(a=function(t,n){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}a(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),f=function(t){function n(n){var e=this;n||(n=[]);var r=function(t){return!!Array.isArray(t)&&t.filter((function(t){return t.ready})).length==t.length}(n),o=0===n.length?"no conditions provided":r?"all ok":"some conditions did not complete";return(e=t.call(this,"summary",r,o,"Summary")||this).details=n,e}return l(n,t),n}(c),h="window-key";function d(t){return t?t===i?function(){return new c(h,!0,"no keys except maybe windows found",t)}:function(){var n=v.test(t);return n.success?new c(h,!0,"all keys matched",t,n.result):new c(h,!1,"Not all keys matched yet. So far '"+n.matchedKey+"' worked.",t)}:function(){return new c(h,!0,"empty key",t)}}function p(t){var n=t.toString();return n&&n.length>25&&(n=n.substr(0,25)),function(){return new c("fn",t(),"",n)}}var g=function(){return(g=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},y="named fn",w=function(){function t(){}return t.prototype.make=function(t){return"function"==typeof t?p(t):"string"==typeof t?t.endsWith("()")?function(t){if(!t.endsWith("()"))throw"Tried to create Function-Name condition but that requires it to end with (), got "+t;var n,e=d(t.substring(0,t.length-2));return function(){if(!n){var t=e();if(!t.ready)return g(g({},t),{type:y});if("function"!=typeof t.result)return g(g({},t),{type:y});n=p(t.result)}return g(g({},n()),{type:y})}}(t):d(t):void 0},t}(),v=function(){function t(t,n,e,r,o,i,s){this.success=t,this.result=n,this.parent=e,this.lastName=r,this.parts=o,this.partsFound=i,this.matchedKey=s}return t.test=function(n){if(!n)return new t(!0,null,null,null,0,0,"");var e=n.split(".");if(e[0]!==i)throw"Key must start with '"+i+".' but it's '"+n+"'";if(1==e.length)return new t(!0,window,null,i,1,1,i);for(var r,o=window,s=null,u=i,a=1;a<e.length;a++)if(s=o,u+="."+(r=e[a]),!(o=o[r]))return new t(!1,null,s,r,e.length,a,u);return new t(!0,o,s,r,e.length,e.length,u)},t}(),m="9-error",b=function(){function t(t,n,e){this.tag=t,this.config=n,this.turnOn=e,this.syncDom()}return t.prototype.syncDom=function(){u("syncDom",this);var t=this.tag;t.getAttribute(o)||t.setAttribute(o,"skip");var n=JSON.stringify(this.config);t.getAttribute(r)!==n&&t.setAttribute(r,n)},t.prototype.progress=function(t){this.config.progress=t,this.syncDom()},t.prototype.error=function(t){throw this.config.progress=m,this.config.error=t,this.syncDom(),this.config.error},t}(),O="error",k="debug",A="reject",E="turnOn",j=function(){this.interval=100,this.attempts=100,this.log=O,this.failure=A,this.name=E},T=function(){return(T=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},P=function(){function t(){}return t.createError=function(t){return{await:[],debug:!1,run:"",progress:m,error:t}},t.load=function(n){var e,r;try{e=JSON.parse(n)}catch(n){return t.createError("detected configuration but cannot parse to json.")}try{r=t.stabilize(e)}catch(n){return t.createError("Error loading configuration, reason unknown.")}return r},t.stabilize=function(n){var e,r;if(!n)return t.createError("No config data found to process");if(!n.run)return t.createError("Config didn't contain 'run' - it's required.");if(!n.run.startsWith("window"))return t.createError("run command must start with 'window.' but is:"+n.run);if(!n.run.endsWith("()"))return t.createError("run must be a function name and end with () but it's:"+n.run);var o=Array.isArray(n.await)?n.await:n.await?[n.await]:[];o.push(n.run.substring(0,n.run.length-2));var i=null!==(e=null==n?void 0:n.debug)&&void 0!==e&&e?k:O;return{await:o,debug:null!==(r=n.debug)&&void 0!==r&&r,run:n.run,progress:"1-loaded",data:n.data||{},settings:T(T(T({},new j),{log:i}),n.settings)}},t}(),S=function(){function t(t){this.root=t,this.tags=new Array}return t.prototype.tryToLoadTag=function(t){var n,e,i=null===(n=null==t?void 0:t.getAttribute)||void 0===n?void 0:n.call(t,r);if(i){var s=null===(e=null==t?void 0:t.getAttribute)||void 0===e?void 0:e.call(t,o);if(u("skip",s),s)return u("skip");u("attr",i);var a=P.load(i);a.progress!==m?(u("stable config"),this.add(t,a)):console.error(a.error,t,i)}},t.prototype.add=function(t,n){u("add",t,n);var e=new b(t,n);this.tags.push(e),function(t,n){var e=n.config;u("convert to turnon");var r=t.new(e.settings);e.settings=r.settings;var o=r.await(e.await);n.progress("2-watching"),o.then((function(){var t=e.run;if(u("turn on success - will try to run "+t),n.progress("3-running"),t.endsWith("()")){var r=v.test(t.substr(0,t.length-2));r.success?"function"==typeof r.result?(r.parent[r.lastName](e.data,{tag:n.tag,config:e}),n.progress("4-completed")):n.error("Got "+r.partsFound+" but it's not a function"):n.error("Tried to find object parts for "+r.matchedKey+" but didn't get anything.")}else n.error("run should end with () but doesn't - can't continue")}))}(this.root,e)},t.prototype.updateTags=function(){u("updateTags: "+this.tags.length),this.tags.forEach((function(t){return t.syncDom()}))},t}(),L="["+r+"]:not(["+o+"])",x=function(){function t(t){this.tagManager=t,this.config={attributes:!1,childList:!0,subtree:!0},this.scanExistingDom(),this.activateObserver()}return t.prototype.scanExistingDom=function(){u("scanExistingDom"),document.documentElement&&this.checkAndLoadChildren(document.documentElement)},t.prototype.checkAndLoadChildren=function(t){var n,e=this;u("checkAndLoadChildren",t),(null===(n=null==t?void 0:t.children)||void 0===n?void 0:n.length)&&t.querySelectorAll(L).forEach((function(t){return e.tagManager.tryToLoadTag(t)}))},t.prototype.activateObserver=function(){var t=this;u("activateObserver"),this.observer=new MutationObserver((function(n){u("mutations detected",n),n.forEach((function(n){"childList"==n.type&&(u("childList changes"),Array.from(n.addedNodes).filter((function(t){return 1===t.nodeType})).forEach((function(n){var e;(null===(e=null==n?void 0:n.getAttribute)||void 0===e?void 0:e.call(n,r))?t.tagManager.tryToLoadTag(n):t.checkAndLoadChildren(n)})))}))})),this.observer.observe(document.documentElement,this.config)},t}(),M=function(){return(M=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},_="promise",C=function(){function t(t,n){this.lastStatus=new c(_,!1,"condition not checked yet"),this.attempts=0,this.innerCheck=t,this.settings=n}return t.prototype.innerCheck=function(){return new c(_,!0,"no condition defined")},t.prototype.check=function(){return!0===this.lastStatus.ready||(this.lastStatus=this.innerCheck()),this.lastStatus},t.prototype.asPromise=function(){var t=this,n=function(e,r){var o=t.check();!0!==o.ready?t.attempts++>=t.settings.attempts?e(M(M({},o),{message:"tried up to max attempts: "+o.message,attempts:t.attempts})):setTimeout(n,t.settings.interval,e,r):e(M(M({},o),{attempts:t.attempts}))};return new Promise(n)},t}(),D=function(){return(D=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},N=function(){function t(n){this.settings=new j,this._conditionMaker=new w,"string"==typeof n&&(n={name:n}),n&&(this.settings=D(D({},this.settings),n)),t.count++}return t.prototype.new=function(n){return new t(n)},t.prototype.await=function(n){var e=this,r=(Array.isArray(n)?n:[n]).map((function(t){if(Promise.resolve(t)===t)return n=t,new Promise((function(t,e){n.then((function(n){t(new c("bool-promise",!1!==n,"from promise"))})).catch((function(t){return e(t)}))}));var n,r=e._conditionMaker.make(t);return new C(r,e.settings).asPromise()})),o=this,i=t.count;return new Promise((function(t,n){Promise.all(r).then((function(e){var r=new f(e);if((window.debugTurnOn||o.settings.log===k||!r.ready&&"silent"!==o.settings.log)&&o.logStatusList(r.ready,i,o.settings,e),!0!==r.ready)switch(o.settings.failure){case A:n(r);break;case"resolve":t(r);break;case"silent":return}else t(new f(e))}))}))},t.prototype.logStatusList=function(t,n,e,r){console.log("turn-on: #"+n+" "+(e.name!==E?'"'+e.name+'" ':"")+(t?"success!":"couldn't complete because some conditions were not met. See details: "),r)},t.count=0,t}(),W=function(){function t(){this.tagManager=new S(this),this.loader=new x(this.tagManager),console.log("turnOn v0.1.2 active - it will help boot scripts when ready - set window.debugTurnOn = true for debugging")}return t.prototype.new=function(t){return new N(t)},t}();window.turnOn||(window.turnOn=new W)}},n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{}};return t[r](o,o.exports,e),o.exports}e.d=(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},e.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),e(309)})();
//# sourceMappingURL=turn-on.js.map